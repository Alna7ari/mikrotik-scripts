:global isScripRun false;
do {
/sys script job get [find where script=check-lines-by-alna7ari]
:set isScripRun true;
} on-error={}
:if ($isScripRun) do={
:error "check-lines-by-alna7ari script already running!!!";
}
do {
/system script remove check-lines-by-alna7ari
/sys script job remove [find where script=check-lines-by-alna7ari]
} on-error={}
/system script add dont-require-permissions=no name=check-lines-by-alna7ari owner=Ahmed policy=\
    ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source="#\
    auto check and reconnect bridge lines by Alna7ari\r\
    \n#the pppoe-out interfaces must name with defualt named like pppoe-out1\r\
    \n#enjoy...\r\
    \n{\r\
    \n:global linesCount 4; #change this var to your pppoe-out count\r\
    \nfor lineNumber from=1 to=\$linesCount step=1 do={\r\
    \n\r\
    \n\tdo {\r\
    \n\t\t:global totalTrafficUsed [/interface get \"pppoe-out\$lineNumber\" r\
    x-packet];\r\
    \n\t\t:put \$totalTrafficUsed;\r\
    \n\t\t:delay 5s;\r\
    \n\t\t:global newTotalTrafficUsed [/interface get \"pppoe-out\$lineNumber\
    \" rx-packet];\r\
    \n\t\t:if (\$totalTrafficUsed != \$newTotalTrafficUsed) do={\r\
    \n\t\t\t:log info (\"calc traffic check: the pppoe-out\$lineNumber is alre\
    ady connected\");\r\
    \n\t\t\t:error \"\";\r\
    \n\t\t}\r\
    \n\t\t:global pingCount [ping 82.114.160.33 interface=\"pppoe-out\$lineNum\
    ber\" count=3];\r\
    \n\t\t:if (\$pingCount >= 1) do={ \r\
    \n\t\t\t:log info (\"ping check: the pppoe-out\$lineNumber is already conn\
    ected\");\r\
    \n\t\t\t:error \"\";\r\
    \n\t\t}\r\
    \n\t\t/interface enable \"pppoe-out\$lineNumber\"; \r\
    \n\t} on-error={ :put \"not-found\"}\r\
    \n}\r\
    \nexecute {\r\
    \n/system script run check-lines-by-alna7ari;\r\
    \n/quit\r\
    \n}\r\
    \n}"
do {
/system scheduler remove check-lines-by-alna7ari
} on-error={}
/system scheduler add name=check-lines-by-alna7ari on-event="/system script run check-lines-by-alna7ari;" policy=\
    ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon \
    start-time=startup

:execute {/system script run check-lines-by-alna7ari;}
:put "check-lines-by-alna7ari script installed seccessfuly!";
